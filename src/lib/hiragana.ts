/**
 * 小学1年生向けに漢字を平仮名に変換する
 * 小学1年生で習う漢字以外を平仮名に変換します
 */

import kanjiData from "@/data/kanji.json";

// 小学1年生で習う漢字のリスト
const grade1Kanji = new Set(kanjiData.elementary.grade1);

/**
 * 文字列内の小学1年生で習わない漢字を平仮名に変換する
 * @param text 変換する文字列
 * @returns 変換後の文字列
 */
export function convertToHiragana(text: string): string {
  // 漢字→平仮名の変換マップ
  const kanjiToHiragana: Record<string, string> = {
    // 学年
    学: "がく",
    年: "ねん",
    生: "せい",
    // 数字
    一: "いち",
    二: "に",
    三: "さん",
    四: "よん",
    五: "ご",
    六: "ろく",
    // 学校
    校: "こう",
    // 漢字関連
    漢: "かん",
    字: "じ",
    // 説明文でよく使う言葉
    小: "しょう",
    中: "ちゅう",
    高: "こう",
    習: "ならう",
    相: "そう",
    当: "とう",
    等: "とう",
    級: "きゅう",
    以: "い",
    上: "じょう",
    下: "か",
    前: "まえ",
    後: "ご",
    半: "はん",
    分: "ぶん",
    違: "ちが",
    異: "い",
    時: "じ",
    間: "かん",
    場: "ば",
    所: "しょ",
    他: "た",
    多: "た",
    少: "しょう",
    大: "だい",
    変: "へん",
    化: "か",
    対: "たい",
    応: "おう",
    関: "かん",
    係: "けい",
    連: "れん",
    続: "ぞく",
    動: "どう",
    作: "さく",
    用: "よう",
    方: "ほう",
    向: "こう",
    的: "てき",
    度: "ど",
    数: "すう",
    値: "ち",
    表: "ひょう",
    示: "じ",
    現: "げん",
    在: "ざい",
    実: "じつ",
    際: "さい",
    特: "とく",
    別: "べつ",
    普: "ふ",
    通: "つう",
    常: "じょう",
    使: "し",
    利: "り",
    便: "べん",
    役: "やく",
    立: "た",
    助: "じょ",
    言: "げん",
    語: "ご",
    話: "わ",
    説: "せつ",
    明: "めい",
    情: "じょう",
    報: "ほう",
    知: "ち",
    識: "しき",
    理: "り",
    解: "かい",
    教: "きょう",
    育: "いく",
    訓: "くん",
    練: "れん",
    経: "けい",
    験: "けん",
  };

  // 文字列を1文字ずつ処理
  return text
    .split("")
    .map((char) => {
      // 漢字の判定（Unicode範囲で判定）
      const isKanji = /[\u4E00-\u9FFF]/.test(char);

      // 小学1年生で習う漢字はそのまま
      if (isKanji && grade1Kanji.has(char)) {
        return char;
      }

      // 漢字で変換マップにあるものは平仮名に変換
      if (isKanji && kanjiToHiragana[char]) {
        return kanjiToHiragana[char];
      }

      // それ以外の文字はそのまま
      return char;
    })
    .join("");
}
